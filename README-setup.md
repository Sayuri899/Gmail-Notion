# Gmail → Notion 自動連携ツール 設定手順書

この度は、「Gmail → Notion 自動連携ツール」をご利用いただきありがとうございます。
このツールを使うと、Gmailで特定のラベルを付けたメールを、自動でNotionのデータベースに追加することができます。

以下の手順に沿って設定を進めてください。プログラミングの知識は不要です。

---

### ■ 1. 準備するもの

設定を始める前に、以下の4つの情報を準備してください。

#### ① Notionシークレットトークン
Notionと連携するためのパスワードのようなものです。
1.  [Notionのマイインテグレーションページ](https://www.notion.so/my-integrations)にアクセスします。
2.  「+ 新しいインテグレーション」をクリックします。
3.  名前（例: Gmail連携ツール）を入力し、「送信」をクリックします。
4.  「シークレット」という項目にある「**Internal Integration Token**」をコピーします。`secret_`から始まる長い文字列です。
    > ⚠️ **このトークンは一度しか表示されません。必ずメモ帳などに控えてください。**

#### ② NotionデータベースID
メールを保存したいNotionデータベースのIDです。
1.  Notionで、メールを保存するための新しいデータベースを作成するか、既存のデータベースを開きます。
2.  ブラウザでそのデータベースを開き、URLを確認します。
3.  URLは `https://www.notion.so/your-workspace/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?v=...` のような形式になっています。この `xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx` の部分（32文字の英数字）が**データベースID**です。これをコピーしてください。

#### ③ Notionデータベースとインテグレーションの連携
作成したインテグレーションに、データベースへのアクセス許可を与えます。
1.  先ほどIDをコピーしたNotionデータベースの右上にある「**・・・**」メニューをクリックします。
2.  「**コネクトの追加**」を選択します。
3.  検索窓に、①で作成したインテグレーションの名前（例: Gmail連携ツール）を入力し、表示されたものをクリックして連携させます。

#### ④ Gmailラベル
Notionに転送したいメールに付けるためのラベルです。
1.  Gmailを開き、左側のメニューから「**新しいラベルを作成**」をクリックします。
2.  分かりやすい名前（例: `Notion行き`）を付けて作成します。

---

### ■ 2. スプレッドシートでの設定手順

ここからは、提供されたスプレッドシートを使って設定を行います。

#### ステップ1: 初期設定とスクリプトの承認

まず、ツールを動かすための準備をします。

1.  スプレッドシート上部にあるカスタムメニューから **「📧 Gmail → Notion」** をクリックします。
2.  表示されたメニューから **「🔧 初期設定」** を選択します。
3.  **「承認が必要です」** というポップアップが表示されたら、「続行」をクリックします。
4.  自分のGoogleアカウントを選択します。
5.  **「このアプリは Google で確認されていません」** という警告画面が表示されることがあります。これはご自身のアカウントでスクリプトを実行するために必要な手順です。
    *   **「詳細」** をクリックします。
    *   一番下に表示される **「（プロジェクト名）（安全でないページ）に移動」** をクリックして承認を進めてください。
6.  「許可」をクリックして、スクリプトがGmailやスプレッドシートを操作することを許可します。
7.  完了すると、「✅ 初期設定完了」というポップアップが表示され、「設定」「ログ」「統計」の3つのシートが作成されます。

#### ステップ2: 「設定」シートの入力

自動的に表示が切り替わった「設定」シートに、準備した情報を入力します。

| 設定項目 | 入力する値 | 説明 |
| :--- | :--- | :--- |
| **NotionデータベースID** | 準備した②のID | メールを保存したいデータベースのIDです。 |
| **Notionシークレットトークン** | 準備した①のトークン | `secret_`から始まる文字列です。 |
| **Notionタイトルプロパティ名** | `Name` （通常は変更不要） | Notionデータベースのタイトル列の名前です。デフォルトは`Name`です。変更している場合はその名前に書き換えてください。 |
| **Gmailラベル名** | 準備した④のラベル名 | Notionに転送したいメールに付けるGmailラベルの名前です。（例: `Notion行き`） |
| **処理後の動作** | `ラベル削除` / `完了ラベル追加` / `アーカイブ` | メールをNotionに登録した後、Gmail側でどう処理するか選びます。 |
| **完了ラベル名** | `Notion処理済み` （任意） | 「処理後の動作」で`完了ラベル追加`を選んだ場合に、新しく付けるラベル名です。 |
| **最終処理日時** | （入力不要） | スクリプトが自動で更新します。 |
| **処理間隔（分）** | `60` （推奨） | 自動でメールをチェックする間隔（分）です。最短1分から設定できます。 |

#### ステップ3: 接続テスト

設定が正しくできたかを確認します。

1.  メニューから **「📧 Gmail → Notion」 > 「🔗 接続テスト」** をクリックします。
2.  **「✅ 接続テスト成功」** と表示されれば、設定は完璧です！
    *   **失敗した場合:** エラーメッセージが表示されます。よくある原因は以下の通りです。
        *   NotionデータベースIDやシークレットトークンが間違っている。
        *   Notionデータベースとインテグレーションが連携されていない。（準備③を確認）
        *   タイトルプロパティ名が間違っている。

#### ステップ4: 手動で動作確認（任意）

自動実行を設定する前に、一度手動で全体の流れをテストしてみましょう。

1.  Gmailで、Notionに送りたいテストメールに、設定したラベル（例: `Notion行き`）を付けます。
2.  スプレッドシートのメニューから **「📧 Gmail → Notion」 > 「▶️ 手動実行」** をクリックします。
3.  確認のポップアップで「はい」をクリックします。
4.  処理が終わったら、Notionデータベースにメールが追加されていること、そしてGmailのメールからラベルが消えている（または設定通りに処理されている）ことを確認してください。

#### ステップ5: 自動実行を設定する

テストが成功したら、いよいよ自動化の設定です。

1.  メニューから **「📧 Gmail → Notion」 > 「⏰ 自動実行設定」** をクリックします。
2.  「✅ 自動実行設定完了」と表示されたら、すべての設定は完了です！
3.  これ以降、「設定」シートで指定した「処理間隔」ごとに、自動でGmailがチェックされ、ラベルが付いたメールがNotionに転送されます。

---

### ■ 3. その他の便利な機能

| メニュー | 機能 |
| :--- | :--- |
| **⏹️ 自動実行停止** | 定期的な自動実行を停止したい場合に使用します。 |
| **📊 ログ確認** | これまでの処理履歴や成功・エラーの統計情報をポップアップで確認できます。「ログ」「統計」シートも参照してください。 |
| **🔍 デバッグ情報** | うまく動作しない時に、設定状況やラベルの存在を確認するための情報を表示します。 |

